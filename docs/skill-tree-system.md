# Skill Tree – Full System Explanation

## 1. Core Concept

The Skill Tree is a **fractal evolution system** where:

- You start with one **base skill** (e.g., Quick Slash at Stage 0)
- By using a skill, you **level that specific skill** through stages
- At each stage, the skill:
  - **Upskills** (stronger version + new passive), and
  - **Branches** into 4 new evolved skills, which themselves can evolve later

Every skill has:
- Its own **use counter**
- Its own **stages**
- Its own **upgrades**
- Its own **passives**
- Its own **children**

Over time, this creates a **huge web of related skills** that all originate from a single base action.

---

## 2. Stages & Use Requirements

Each skill progresses through stages based on how many times **that specific skill** is used.

| Stage | Uses Required | Cumulative |
|-------|---------------|------------|
| Stage 0 → Stage 1 | 100 uses | 100 |
| Stage 1 → Stage 2 | 300 uses | 400 |
| Stage 2 → Stage 3 | 500 uses | 900 |
| Stage 3 → Stage 4 | 900 uses | 1,800 |
| Stage 4 → Stage 5 | 1,500 uses | 3,300 |

> **Important:** The use counter is **per skill**, not shared.
> Using Quick Slash only counts for Quick Slash, not for Double Slash, etc.

---

## 3. Stage 0 – Root

### 3.1 Root Skill

**Quick Slash (Stage 0)**

This is the starting point of the entire tree.

It has:
- No prior stages
- No children yet
- No passive yet (passives start from Stage 1)

At this point, the only skill tracked in this tree is:
- Quick Slash (Stage 0)

---

## 4. Stage 1 – First Branch (100 uses)

When the player uses Quick Slash **100 times**:

### 4.1 Quick Slash Evolves

Quick Slash reaches **Stage 1** and unlocks:

**Upskill of Quick Slash:**
- Example name: **Quick Slash I** (Stage 1)
- Effect: An upgraded version (more damage / faster / cheaper)
- Also unlocks a **Stage 1 passive** for Quick Slash

**4 New Evolved Skills (Stage 1):**
1. Double Slash
2. Step-In Slash
3. Precision Cut
4. Guard-Cut Slash

Each of these 4 new skills:
- Starts at Stage 1
- Has its own use counter
- Has its own Stage 1 passive tied to it

### 4.2 What You Have After Stage 1

| Skill | Stage |
|-------|-------|
| Quick Slash I | Stage 1 |
| Double Slash | Stage 1 |
| Step-In Slash | Stage 1 |
| Precision Cut | Stage 1 |
| Guard-Cut Slash | Stage 1 |

**Passives:** Each of these 5 skills has 1 passive at Stage 1 → **5 passives total**

From here on:
- Each of these 5 skills will track its own uses
- Each can independently reach Stage 2, Stage 3, etc.

---

## 5. Stage 2 – Full Branching (300 uses each)

Each of the 5 Stage 1 skills can evolve if it is used **300 times**.

### 5.1 What Happens When a Skill Hits Stage 2

For any Stage 1 skill hitting Stage 2:
1. It unlocks **1 Upskill** of itself at Stage 2
2. It unlocks **4 new evolved skills** derived from it (Stage 2 children)
3. It gains **1 new passive** for Stage 2

**Example: Quick Slash at Stage 2**

When Quick Slash reaches Stage 2:
- **Upskill:** Quick Slash II (Stage 2)
- **Stage 2 passive** for Quick Slash
- **4 New Skills:**
  1. Triple Slash
  2. Flash Reposition
  3. Weak Point Slash
  4. Retaliation Slash

**Example: Double Slash at Stage 2**

When Double Slash reaches Stage 2:
- **Upskill:** Double Slash II (Stage 2)
- **Stage 2 passive** for Double Slash
- **4 New Skills:**
  1. Quad Slash
  2. Criss-Cross Combo
  3. Driving Twin Slash
  4. Double Ender

### 5.2 What You Have After Stage 2

- Started with 5 Stage 1 skills
- Each has: 1 Stage 2 upskill + 4 new Stage 2 children

**Calculation:**
- 5 parents × (1 parent + 4 new children) = **25 skills at Stage 2**

Each of these 25 skills has:
- An active version (the skill itself)
- A passive tied to its current stage
- Its own use counter

---

## 6. Stage 3 – Explosion of Branches (500 uses each)

At this point, you have **25 different skills** in the Quick Slash family.

### 6.1 Evolution Rule at Stage 3

For every one of those 25 skills, when that skill reaches **500 uses**:
1. Unlock 1 upskill (Stage 3 version)
2. Unlock 4 new evolved skills (Stage 3 children)
3. Gain 1 Stage 3 passive

**Calculation:**
- 25 parents × 5 = **125 skills at Stage 3**

---

## 7. Stage 4 – Massive Web (900 uses each)

At this stage, you have **125 skills** from Stage 3.

### 7.1 Evolution Rule at Stage 4

For every Stage 3 skill, when it reaches **900 uses**:
1. Evolves to Stage 4 version (upskill)
2. Spawns 4 new evolved skills (Stage 4 children)
3. Gains 1 new Stage 4 passive

**Calculation:**
- 125 parents × 5 = **625 skills at Stage 4**

---

## 8. Stage 5 – Full Mastery Web (1,500 uses each)

At this final stage, you have **625 skills** from Stage 4.

### 8.1 Evolution Rule at Stage 5

For each Stage 4 skill, when it reaches **1,500 uses**:
1. Evolves to Stage 5 version (final upskill)
2. Spawns 4 new Stage 5 children
3. Gains 1 new Stage 5 passive

**Calculation:**
- 625 parents × 5 = **3,125 skills at Stage 5**

---

## 9. Summary: Fractal Skill-Web from One Skill

Starting from one simple root skill: **Quick Slash (Stage 0)**

| Stage | Skills Total | New Skills Added |
|-------|--------------|------------------|
| Stage 0 | 1 | 1 (root) |
| Stage 1 | 5 | 5 |
| Stage 2 | 25 | 25 |
| Stage 3 | 125 | 125 |
| Stage 4 | 625 | 625 |
| Stage 5 | 3,125 | 3,125 |

**Each skill in this web:**
- Tracks its own uses
- Has its own upskill line (Stage 1–5 versions)
- Has 1 passive per stage
- Spawns 4 new child skills when it reaches a new stage

---

## 10. Player Impact

The player's **playstyle** (which skills they actually use a lot):
- Determines **which branches grow**
- Determines **which passives unlock**
- Determines **what kind of master they become**

A player who focuses on:
- **Quick Slash → Double Slash → Quad Slash** becomes a combo specialist
- **Quick Slash → Precision Cut → Weak Point Slash** becomes a precision striker
- **Quick Slash → Guard-Cut Slash → Counter variants** becomes a defensive counter-attacker

---

## 11. Implementation Notes

### Database Schema

```prisma
model PlayerSkill {
  id            String   @id @default(cuid())
  playerId      String
  player        Player   @relation(...)
  
  skillId       String
  skill         Skill    @relation(...)
  
  useCount      Int      @default(0)
  stage         Int      @default(0)  // 0-5
  
  // Parent skill reference for tree structure
  parentSkillId String?
  parentSkill   PlayerSkill? @relation("SkillTree", fields: [parentSkillId], references: [id])
  childSkills   PlayerSkill[] @relation("SkillTree")
  
  learnedAt     DateTime @default(now())
  evolvedAt     DateTime?
}

model SkillPassive {
  id          String @id @default(cuid())
  skillId     String
  skill       Skill  @relation(...)
  
  stage       Int    // 1-5
  name        String
  description String
  effect      String // JSON or enum for effect type
  value       Float
}
```

### Stage Thresholds

```typescript
const STAGE_THRESHOLDS = {
  1: 100,
  2: 300,
  3: 500,
  4: 900,
  5: 1500,
}

function canEvolve(useCount: number, currentStage: number): boolean {
  const nextStage = currentStage + 1
  if (nextStage > 5) return false
  return useCount >= STAGE_THRESHOLDS[nextStage]
}
```

### Evolution Logic

```typescript
async function evolveSkill(playerSkillId: string) {
  const playerSkill = await getPlayerSkill(playerSkillId)
  
  if (!canEvolve(playerSkill.useCount, playerSkill.stage)) {
    return { success: false, reason: 'Not enough uses' }
  }
  
  // 1. Upgrade current skill to next stage
  await upgradeSkillStage(playerSkillId)
  
  // 2. Unlock stage passive
  await unlockPassive(playerSkillId, playerSkill.stage + 1)
  
  // 3. Spawn 4 child skills
  const childSkills = getChildSkillsForStage(playerSkill.skillId, playerSkill.stage + 1)
  for (const childSkill of childSkills) {
    await learnSkill(playerSkill.playerId, childSkill.id, playerSkillId)
  }
  
  return { success: true, newStage: playerSkill.stage + 1, newSkills: childSkills }
}
```
